<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Sheets CRUD Frontend</title>
<style>
  body { font-family: Arial; margin: 40px; }
  input, button { margin: 5px; padding: 6px; }
  table { border-collapse: collapse; margin-top: 20px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  pre { background: #f7f7f7; padding: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2>Google Sheets CRUD API Frontend</h2>

<label>ID:</label><input id="id" placeholder="ID"><br>
<label>Name:</label><input id="name" placeholder="Name"><br>
<label>Email:</label><input id="email" placeholder="Email"><br>

<button onclick="addRecord()">Add</button>
<button onclick="editRecord()">Edit</button>
<button onclick="deleteRecord()">Delete</button>
<button onclick="getRecords()">Get All</button>

<h3>API Response:</h3>
<pre id="output"></pre>

<h3>Records Table:</h3>
<table id="recordsTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Email</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyw5Y7O1k20tcPeBfWLHnVTIKrcVb8diJXwExHRE0A1x9t3l3uLq7Wsad-59ekAJGwQ-Q/exec";
const API_KEY = "12345";

// Get form data
function getFormData() {
  return {
    ID: document.getElementById("id").value,
    Name: document.getElementById("name").value,
    Email: document.getElementById("email").value
  };
}

// Display output
function showOutput(data) {
  document.getElementById("output").textContent = JSON.stringify(data, null, 2);
}

// Render table
function renderTable(records) {
  const tbody = document.querySelector("#recordsTable tbody");
  tbody.innerHTML = "";
  records.forEach(r => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${r.ID}</td><td>${r.Name}</td><td>${r.Email}</td>`;
    tbody.appendChild(row);
  });
}

// GET all records
async function getRecords() {
  const url = `${API_URL}?action=get&apikey=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  showOutput(data);
  if (data.status === "success") renderTable(data.data);
}

// Generic CRUD using GET + query params (CORS safe)
async function sendRecord(action, record) {
  const params = new URLSearchParams({ apikey: API_KEY, action });
  Object.keys(record).forEach(k => { if (record[k]) params.append(k, record[k]); });
  const url = `${API_URL}?${params.toString()}`;
  const res = await fetch(url);
  const data = await res.json();
  showOutput(data);
  getRecords();
}

// Add
function addRecord() {
  const record = getFormData();
  if (!record.ID) { alert("ID is required"); return; }
  sendRecord("add", record);
}

// Edit
function editRecord() {
  const record = getFormData();
  if (!record.ID) { alert("ID is required"); return; }
  sendRecord("edit", record);
}

// Delete
function deleteRecord() {
  const id = document.getElementById("id").value;
  if (!id) { alert("ID is required"); return; }
  sendRecord("delete", { ID: id });
}

// Load table on page load
window.onload = getRecords;
</script>

</body>
</html>
