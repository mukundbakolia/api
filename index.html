<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Sheets CRUD Frontend</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; }
  input, button { margin: 5px; padding: 6px; }
  table { border-collapse: collapse; margin-top: 20px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  pre { background: #f7f7f7; padding: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2>Google Sheets CRUD API Frontend</h2>

<label>ID:</label><input id="id" placeholder="ID"><br>
<label>Name:</label><input id="name" placeholder="Name"><br>
<label>Email:</label><input id="email" placeholder="Email"><br>

<button onclick="addRecord()">Add</button>
<button onclick="editRecord()">Edit</button>
<button onclick="deleteRecord()">Delete</button>
<button onclick="getRecords()">Get All</button>

<h3>API Response:</h3>
<pre id="output"></pre>

<h3>Records Table:</h3>
<table id="recordsTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Email</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbz1XHraDKXLkzTc1LCccsRzrppnwkJhiMZXwHlvnr7VFbN20xCEwf5vulMd5jK0jUO0HQ/exec";
  const API_KEY = "12345"; // Your API key

  // Helper: Get form data
  function getFormData() {
    return {
      ID: document.getElementById("id").value,
      Name: document.getElementById("name").value,
      Email: document.getElementById("email").value
    };
  }

  // Helper: Display response in <pre>
  function showOutput(data) {
    document.getElementById("output").textContent = JSON.stringify(data, null, 2);
  }

  // Helper: Render records table
  function renderTable(records) {
    const tbody = document.querySelector("#recordsTable tbody");
    tbody.innerHTML = "";
    records.forEach(r => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${r.ID}</td><td>${r.Name}</td><td>${r.Email}</td>`;
      tbody.appendChild(row);
    });
  }

  // GET all records
  async function getRecords() {
    try {
      const res = await fetch(`${API_URL}?action=get&apikey=${API_KEY}`);
      const data = await res.json();
      showOutput(data);
      if (data.status === "success") renderTable(data.data);
    } catch (err) {
      showOutput({ status: "error", message: err.message });
    }
  }

  // POST helper
  async function postRecord(action, record) {
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ apikey: API_KEY, action, record })
      });
      const data = await res.json();
      showOutput(data);
      getRecords(); // refresh table
    } catch (err) {
      showOutput({ status: "error", message: err.message });
    }
  }

  // Add record
  function addRecord() {
    const record = getFormData();
    if (!record.ID) { alert("ID is required"); return; }
    postRecord("add", record);
  }

  // Edit record
  function editRecord() {
    const record = getFormData();
    if (!record.ID) { alert("ID is required"); return; }
    postRecord("edit", record);
  }

  // Delete record
  function deleteRecord() {
    const record = { ID: document.getElementById("id").value };
    if (!record.ID) { alert("ID is required"); return; }
    postRecord("delete", record);
  }

  // Load records on page load
  window.onload = getRecords;
</script>

</body>
</html>
